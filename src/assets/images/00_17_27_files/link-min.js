!function(e){"use strict";function t(){this.bitsNeeded=0,this.codePoint=0}function n(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=A,this.onload=A,this.onerror=A,this.onreadystatechange=A,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=A}function o(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+32)})}function r(e){for(var t=Object.create(null),n=e.split("\r\n"),r=0;r<n.length;r+=1){var s=n[r].split(": "),i=s.shift(),a=s.join(": ");t[o(i)]=a}this._map=t}function s(){}function i(e){this._headers=e}function a(){}function d(){this._listeners=Object.create(null)}function l(e){m(function(){throw e},0)}function c(e){this.type=e,this.target=void 0,this.defaultPrevented=!1}function u(e,t){c.call(this,e),this.data=t.data,this.lastEventId=t.lastEventId}function h(e,t){c.call(this,e),this.status=t.status,this.statusText=t.statusText,this.headers=t.headers}function f(e,t){d.call(this),t=t||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,function(e,t,o){t=String(t);var r=Boolean(o.withCredentials),i=U(1e3),d=M(o.heartbeatTimeout,45e3),f="",y=i,C=!1,g=o.headers||{},$=o.Transport,w=X&&null==$?void 0:new n(null!=$?new $:p()),_=null!=$&&"string"!=typeof $?new $:null==w?new a:new s,b=void 0,x=0,T=O,E="",S="",k="",A="",Y=q,B=0,G=0,z=function(t,n,o,r){if(T===R)if(200===t&&null!=o&&L.test(o)){T=I,C=!0,y=i,e.readyState=I;var s=new h("open",{status:t,statusText:n,headers:r});e.dispatchEvent(s),V(e,e.onopen,s)}else{var a="";200!==t?(n&&(n=n.replace(/\s+/g," ")),a="EventSource's response has a status "+t+" "+n+" that is not 200. Aborting the connection."):a="EventSource's response has a Content-Type specifying an unsupported type: "+(null==o?"-":o.replace(/\s+/g," "))+". Aborting the connection.",Z();var s=new h("error",{status:t,statusText:n,headers:r});e.dispatchEvent(s),V(e,e.onerror,s),s.defaultPrevented||l(new Error(a))}},F=function(t){if(T===I){for(var n=-1,o=0;o<t.length;o+=1){var r=t.charCodeAt(o);(r==="\n".charCodeAt(0)||r==="\r".charCodeAt(0))&&(n=o)}var s=(-1!==n?A:"")+t.slice(0,n+1);A=(-1===n?A:"")+t.slice(n+1),""!==s&&(C=!0);for(var a=0;a<s.length;a+=1){var r=s.charCodeAt(a);if(Y===j&&r==="\n".charCodeAt(0))Y=q;else if(Y===j&&(Y=q),r==="\r".charCodeAt(0)||r==="\n".charCodeAt(0)){if(Y!==q){Y===H&&(G=a+1);var l=s.slice(B,G-1),c=s.slice(G+(a>G&&s.charCodeAt(G)===" ".charCodeAt(0)?1:0),a);"data"===l?(E+="\n",E+=c):"id"===l?S=c:"event"===l?k=c:"retry"===l?(i=M(c,i),y=i):"heartbeatTimeout"===l&&(d=M(c,d),0!==x&&(v(x),x=m(function(){J()},d)))}if(Y===q){if(""!==E){f=S,""===k&&(k="message");var h=new u(k,{data:E.slice(1),lastEventId:S});if(e.dispatchEvent(h),"open"===k?V(e,e.onopen,h):"message"===k?V(e,e.onmessage,h):"error"===k&&V(e,e.onerror,h),T===P)return}E="",k=""}Y=r==="\r".charCodeAt(0)?j:q}else Y===q&&(B=a,Y=H),Y===H?r===":".charCodeAt(0)&&(G=a+1,Y=D):Y===D&&(Y=N)}}},K=function(t){if(T===I||T===R){T=O,0!==x&&(v(x),x=0),x=m(function(){J()},y),y=U(Math.min(16*i,2*y)),e.readyState=R;var n=new c("error");e.dispatchEvent(n),V(e,e.onerror,n),null!=t&&(n.defaultPrevented||l(t))}},Z=function(){T=P,null!=b&&(b.abort(),b=void 0),0!==x&&(v(x),x=0),e.readyState=P},J=function(){if(x=0,T===O){C=!1,x=m(function(){J()},d),T=R,E="",k="",S=f,A="",B=0,G=0,Y=q;var n=t;"data:"!==t.slice(0,5)&&"blob:"!==t.slice(0,5)&&""!==f&&(n+=(-1===t.indexOf("?")?"?":"&")+"lastEventId="+encodeURIComponent(f));var o=e.withCredentials,r={Accept:"text/event-stream"},s=e.headers;if(null!=s)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i]);try{b=_.open(w,z,F,K,n,o,r)}catch(e){throw Z(),e}}else C||null==b?(C=!1,x=m(function(){J()},d)):(K(new Error("No activity within "+d+" milliseconds. Reconnecting.")),b.abort(),b=void 0)};e.url=t,e.readyState=R,e.withCredentials=r,e.headers=g,e._close=Z,J()}(this,e,t)}function p(){return null!=y&&"withCredentials"in y.prototype||null==C?new y:new C}var m=e.setTimeout,v=e.clearTimeout,y=e.XMLHttpRequest,C=e.XDomainRequest,g=e.ActiveXObject,$=e.EventSource,w=e.document,_=e.Promise,b=e.fetch,x=e.Response,T=e.TextDecoder,E=e.TextEncoder,S=e.AbortController;if("undefined"==typeof window||"readyState"in w||null!=w.body||(w.readyState="loading",window.addEventListener("load",function(e){w.readyState="complete"},!1)),null==y&&(y=function(){return new g("Microsoft.XMLHTTP")}),null==Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),null==S){var k=b;b=function(e,t){var n=t.signal;return k(e,{headers:t.headers,credentials:t.credentials,cache:t.cache}).then(function(e){var t=e.body.getReader();return n._reader=t,n._aborted&&n._reader.cancel(),{status:e.status,statusText:e.statusText,headers:e.headers,body:{getReader:function(){return t}}}})},S=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){null!=this.signal._reader&&this.signal._reader.cancel(),this.signal._aborted=!0}}}t.prototype.decode=function(e){function t(e,t,n){if(1===n)return e>=128>>t&&2047>=e<<t;if(2===n)return e>=2048>>t&&55295>=e<<t||e>=57344>>t&&65535>=e<<t;if(3===n)return e>=65536>>t&&1114111>=e<<t;throw new Error}function n(e,t){if(6===e)return t>>6>15?3:t>31?2:1;if(12===e)return t>15?3:2;if(18===e)return 3;throw new Error}for(var o=65533,r="",s=this.bitsNeeded,i=this.codePoint,a=0;a<e.length;a+=1){var d=e[a];0!==s&&(128>d||d>191||!t(i<<6|63&d,s-6,n(s,i)))&&(s=0,i=o,r+=String.fromCharCode(i)),0===s?(d>=0&&127>=d?(s=0,i=d):d>=192&&223>=d?(s=6,i=31&d):d>=224&&239>=d?(s=12,i=15&d):d>=240&&247>=d?(s=18,i=7&d):(s=0,i=o),0===s||t(i,s,n(s,i))||(s=0,i=o)):(s-=6,i=i<<6|63&d),0===s&&(65535>=i?r+=String.fromCharCode(i):(r+=String.fromCharCode(55296+(i-65535-1>>10)),r+=String.fromCharCode(56320+(i-65535-1&1023))))}return this.bitsNeeded=s,this.codePoint=i,r};null!=T&&null!=E&&function(){try{return"test"===(new T).decode((new E).encode("test"),{stream:!0})}catch(e){}return!1}()||(T=t);var A=function(){};n.prototype.open=function(e,t){this._abort(!0);var n=this,o=this._xhr,r=1,s=0;this._abort=function(e){0!==n._sendTimeout&&(v(n._sendTimeout),n._sendTimeout=0),(1===r||2===r||3===r)&&(r=4,o.onload=A,o.onerror=A,o.onabort=A,o.onprogress=A,o.onreadystatechange=A,o.abort(),0!==s&&(v(s),s=0),e||(n.readyState=4,n.onabort(null),n.onreadystatechange())),r=0};var i=function(){if(1===r){var e=0,t="",s=void 0;if("contentType"in o)e=200,t="OK",s=o.contentType;else try{e=o.status,t=o.statusText,s=o.getResponseHeader("Content-Type")}catch(n){e=0,t="",s=void 0}0!==e&&(r=2,n.readyState=2,n.status=e,n.statusText=t,n._contentType=s,n.onreadystatechange())}},a=function(){if(i(),2===r||3===r){r=3;var e="";try{e=o.responseText}catch(e){}n.readyState=3,n.responseText=e,n.onprogress()}},d=function(e,t){if((null==t||null==t.preventDefault)&&(t={preventDefault:A}),a(),1===r||2===r||3===r){if(r=4,0!==s&&(v(s),s=0),n.readyState=4,"load"===e)n.onload(t);else if("error"===e)n.onerror(t);else{if("abort"!==e)throw new TypeError;n.onabort(t)}n.onreadystatechange()}},l=function(){s=m(function(){l()},500),3===o.readyState&&a()};"onload"in o&&(o.onload=function(e){d("load",e)}),"onerror"in o&&(o.onerror=function(e){d("error",e)}),"onabort"in o&&(o.onabort=function(e){d("abort",e)}),"sendAsBinary"in y.prototype||"mozAnon"in y.prototype||"onprogress"in o&&(o.onprogress=a),o.onreadystatechange=function(e){!function(e){null!=o&&(4===o.readyState?"onload"in o&&"onerror"in o&&"onabort"in o||d(""===o.responseText?"error":"load",e):3===o.readyState?a():2===o.readyState&&i())}(e)},("contentType"in o||!("ontimeout"in y.prototype))&&(t+=(-1===t.indexOf("?")?"?":"&")+"padding=true"),o.open(e,t,!0),"readyState"in o&&(s=m(function(){l()},0))},n.prototype.abort=function(){this._abort(!1)},n.prototype.getResponseHeader=function(e){return this._contentType},n.prototype.setRequestHeader=function(e,t){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(e,t)},n.prototype.getAllResponseHeaders=function(){return null!=this._xhr.getAllResponseHeaders&&this._xhr.getAllResponseHeaders()||""},n.prototype.send=function(){if("ontimeout"in y.prototype||null==w||null==w.readyState||"complete"===w.readyState){var e=this._xhr;"withCredentials"in e&&(e.withCredentials=this.withCredentials);try{e.send(void 0)}catch(e){throw e}}else{var t=this;t._sendTimeout=m(function(){t._sendTimeout=0,t.send()},4)}},r.prototype.get=function(e){return this._map[o(e)]},null!=y&&null==y.HEADERS_RECEIVED&&(y.HEADERS_RECEIVED=2),s.prototype.open=function(e,t,n,o,s,i,a){e.open("GET",s);var d=0;for(var l in e.onprogress=function(){var t=e.responseText.slice(d);d+=t.length,n(t)},e.onerror=function(e){e.preventDefault(),o(new Error("NetworkError"))},e.onload=function(){o(null)},e.onabort=function(){o(null)},e.onreadystatechange=function(){if(e.readyState===y.HEADERS_RECEIVED){var n=e.status,o=e.statusText,s=e.getResponseHeader("Content-Type"),i=e.getAllResponseHeaders();t(n,o,s,new r(i))}},e.withCredentials=i,a)Object.prototype.hasOwnProperty.call(a,l)&&e.setRequestHeader(l,a[l]);return e.send(),e},i.prototype.get=function(e){return this._headers.get(e)},a.prototype.open=function(e,t,n,o,r,s,a){var d=null,l=new S,c=l.signal,u=new T;return b(r,{headers:a,credentials:s?"include":"same-origin",signal:c,cache:"no-store"}).then(function(e){return d=e.body.getReader(),t(e.status,e.statusText,e.headers.get("Content-Type"),new i(e.headers)),new _(function(e,t){var o=function(){d.read().then(function(t){if(t.done)e(void 0);else{var r=u.decode(t.value,{stream:!0});n(r),o()}}).catch(function(e){t(e)})};o()})}).catch(function(e){return"AbortError"===e.name?void 0:e}).then(function(e){o(e)}),{abort:function(){null!=d&&d.cancel(),l.abort()}}},d.prototype.dispatchEvent=function(e){e.target=this;var t=this._listeners[e.type];if(null!=t)for(var n=t.length,o=0;n>o;o+=1){var r=t[o];try{"function"==typeof r.handleEvent?r.handleEvent(e):r.call(this,e)}catch(e){l(e)}}},d.prototype.addEventListener=function(e,t){e=String(e);var n=this._listeners,o=n[e];null==o&&(o=[],n[e]=o);for(var r=!1,s=0;s<o.length;s+=1)o[s]===t&&(r=!0);r||o.push(t)},d.prototype.removeEventListener=function(e,t){e=String(e);var n=this._listeners,o=n[e];if(null!=o){for(var r=[],s=0;s<o.length;s+=1)o[s]!==t&&r.push(o[s]);0===r.length?delete n[e]:n[e]=r}},c.prototype.preventDefault=function(){this.defaultPrevented=!0},u.prototype=Object.create(c.prototype),h.prototype=Object.create(c.prototype);var O=-1,R=0,I=1,P=2,j=-1,q=0,H=1,D=2,N=3,L=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,M=function(e,t){var n=null==e?t:parseInt(e,10);return n!=n&&(n=t),U(n)},U=function(e){return Math.min(Math.max(e,1e3),18e6)},V=function(e,t,n){try{"function"==typeof t&&t.call(e,n)}catch(e){l(e)}},X=null!=b&&null!=x&&"body"in x.prototype;f.prototype=Object.create(d.prototype),f.prototype.CONNECTING=R,f.prototype.OPEN=I,f.prototype.CLOSED=P,f.prototype.close=function(){this._close()},f.CONNECTING=R,f.OPEN=I,f.CLOSED=P,f.prototype.withCredentials=void 0;var Y=$;null==y||null!=$&&"withCredentials"in $.prototype||(Y=f),function(t){if("object"==typeof module&&"object"==typeof module.exports){var n=t(exports);void 0!==n&&(module.exports=n)}else"function"==typeof define&&define.amd?define(["exports"],t):t(e)}(function(e){e.EventSourcePolyfill=f,e.NativeEventSource=$,e.EventSource=Y})}("undefined"!=typeof window?window:"undefined"!=typeof self?self:this),function(){var e,t,n,o,r,s,i,a,d,l,c,u=!1;const h={};function f(){if(!("undefined"!=typeof Plasm))return y();const t=e.plasm_enabled,n=e.plasm_screen_enabled;t||n?function(t,n){const o=(i=new Plasm({debug:!0,clientToken:req.plasmApiKey,sessionUuid:e.plasmSessionUuid,expiresIn:e.expiresIn})).supportedCollectors,r=t&&o.includes("camera"),s=n&&o.includes("screen");r&&(h.camera=null);s&&(h.screen=null);$(".plasm-setup-camera, .plasm-setup-camera-retry").on("click",()=>m("camera")),$(".plasm-setup-screen, .plasm-setup-screen-retry").on("click",()=>m("screen")),function(e,t){v(e,t),$(".plasm").removeClass("hidden"),$(".plasm-consent").removeClass("hidden")}(r,s),p()}(t,n):y()}function p(){const e=function(){let e;for(const t in h)if(null===h[t]){e=t;break}return e}();e?($(".plasm-setup").removeClass("hidden"),$(".plasm-setup-collector").addClass("hidden"),$(".plasm-setup-"+e).removeClass("hidden")):function(){const e=h.camera&&h.camera.stream,t=h.screen&&h.screen.stream;if(e){const t=$("#plasm-video video")[0];t.srcObject=e,t.setAttribute("playsinline",!0),t.play()}if(t){const e=$("#plasm-screen-video video")[0];e.srcObject=t,e.setAttribute("playsinline",!0),e.play()}v(e,t),$(".plasm").removeClass("hidden"),e||t?($(".plasm-caliber").removeClass("hidden"),$(".plasm-works").click(function(){$(".plasm").remove(),y()})):y()}()}function m(t){const n=e.expiresIn/100*1e3;$(".plasm-setup").addClass("hidden"),$(".plasm-consent").remove(),$(".plasm-error").addClass("hidden"),"camera"===t&&($(".loading").removeClass("hidden"),d=setTimeout(function(){$(".loading").addClass("hidden")},2e3)),i.setupCollector({id:t,interval:n}).then(e=>{"camera"===t&&(clearTimeout(d),$(".loading").addClass("hidden")),["permission_denied","device_not_found"].includes(e.status)?$(".plasm-"+t+"-access-error").removeClass("hidden"):"screen"===t&&"not_supported"!==e.status&&"monitor"!==e.meta.selectedArea?$(".plasm-screen-area-error").removeClass("hidden"):(h[t]=e,"camera"===t&&$(".plasm-setup-camera-enabled-hint").removeClass("hidden"),p())})}function v(e,t){$(".plasm-hint-camera, .plasm-hint-screen, .plasm-hint-camera-and-screen").addClass("hidden"),e&&$(".plasm-hint-camera").removeClass("hidden"),t&&$(".plasm-hint-screen").removeClass("hidden"),e&&t&&$(".plasm-hint-camera-and-screen").removeClass("hidden")}function y(){l="undefined"!=typeof EventSource?window.EventSource:window.EventSourcePolyfill,(c=new l("/stream?entityType=formViewers&linkHash="+req.link.hash)).onmessage=function(e){"formSubmitted"===JSON.parse(e.data).event&&($("title").text("Form submitted"),C(),$(".form-submitted").removeClass("hidden"))},$(".loading").removeClass("hidden"),e.hideTimer&&$(".link-opened").addClass("hide-timer"),e.openedAt?g():$.ajax({url:"/api/v1/Link/@hash/"+req.link.hash+"/visit?open=true"}).done(function(t){e=t.data.link,r=t.data.serverTime,g()})}function C(){!function(){o=!0,t&&clearInterval(t);$(".timer").remove(),w()}(),c.close(),$(".loading").addClass("hidden")}function g(){var n;n=moment.duration(moment()-moment(r)).asSeconds(),s=moment(e.openedAt).add(n,"seconds");var d=e.page.url;d="https://docs.google.com/forms/d/e/"+d+"/viewform?entry."+e.page.entry+"="+req.link.hash,e.forceClose&&($(".time-left-overtime-soft").addClass("hidden"),$(".time-left-overtime-hard").removeClass("hidden")),$(".frame").attr("src",d),$(".frame").on("load",function(){var n;u||(u=!0,a=s.add(e.expiresIn,"seconds"),i&&i.start().then(e=>{$.ajax({type:"POST",url:"/api/v1/Link/@hash/"+req.link.hash+"/savePlasmSessionUuid",data:{plasmSessionUuid:e}})}),!e.hideTimer&&(n=1e3*e.expiresIn,setTimeout(function(){$(".time-left").addClass("faded")},5e3),t=setInterval(function(){if(!o){var t,r,s=moment.duration(a-moment()),i=s.asSeconds();t=s>0?s/n*100:0,$(".timer").removeClass("invisible"),e.forceClose&&(i<0&&($("title").text("Time over"),w(),$(".loading").removeClass("hidden")),i<-5&&($("title").text("Time over"),$(".force-closed").removeClass("hidden"),$(".link-opened").addClass("hidden"),$(".frame").remove(),C())),$(".time-option").addClass("hidden"),i<-36e5?(r="1h+",$(".time-option").removeClass("hidden")):i<0?($(".time-left-overtime-soft").removeClass("hidden"),r=d(-s.hours())+":"+d(-s.minutes())+":"+d(-s.seconds())):i<60?($(".time-left-overtime-hard").removeClass("hidden"),r=d(s.hours())+":"+d(s.minutes())+":"+d(s.seconds())):($(".time-left-countdown").removeClass("hidden"),r=d(s.hours())+":"+d(s.minutes())+":"+d(s.seconds())),i<0?$(".timer-percentage").remove():$(".timer-percentage").css({width:t+"%"}),i<60&&$(".timer").addClass("overtime"),i<60&&i>=0?$(".timer").addClass("pulsate"):$(".timer").removeClass("pulsate"),$(".time-left-value").text(r),$("title").text(r)}function d(e){return 1===(e=e.toString()).length&&(e="0"+e),e}},500)),$(".loading").addClass("hidden"),$(".link-opened").removeClass("hidden"))}),window.addEventListener("blur",function(){$.ajax({type:"POST",url:"/api/v1/Link/@hash/"+req.link.hash+"/unfocus"})})}function w(){i&&i.stop()}$.ajax({url:"/api/v1/Link/@hash/"+req.link.hash+"/visit"}).done(function(t){if($(".loading").addClass("hidden"),e=t.data.link,"not found"!==t.status)if("expired"!==t.status)if("used"!==t.status)if("ok"===t.status)if(e.off)$(".link-not-available").removeClass("hidden");else if(t.data.googleFormIsRestricted)$(".link-white-screen-issue").removeClass("hidden");else{if(e.allow_view_score_after_submission&&e.is_quiz||$(".form-submitted").addClass("hideScore"),$(".caution-header").text(e.form_label),e.respondentEmail&&($(".caution-respondent").removeClass("hidden"),$(".caution-respondent-email").text(e.respondentEmail)),e.welcome_message&&$(".caution-message").text(e.welcome_message),e.open_form_text&&$(".caution-proceed").text(e.open_form_text),e.openedAt)return r=t.data.serverTime,void f();e.forceClose&&$(".caution-auto-close").removeClass("hidden"),e.requires_login||e.limited_to_one_response?(e.requires_login&&$(".caution-login-required-company").removeClass("hidden"),$(".caution-login-required").removeClass("hidden")):e.start_from&&moment(e.start_from).isAfter(moment())?($(".link-later").removeClass("hidden"),$(".link-later-from").removeClass("hidden"),$(".link-later-date-from").text(moment(e.start_from).format("HH:mm (UTCZ), MMMM Do YYYY")),setInterval(()=>{const t=moment(e.start_from).isSameOrBefore(moment());t&&window.location.reload()},1e3)):(e.start_from&&moment().isAfter(moment(e.start_from))&&(n=setInterval(()=>{const t=moment().isAfter(moment(e.start_from).add(e.expiresIn,"seconds"));t&&window.location.reload()},1e3)),$(".caution-proceed").removeClass("hidden")),$(".link-first-visit").removeClass("hidden");var o=Math.floor(e.expiresIn/60);$(".caution-message-time-value").text(o)}else $(".link-not-available").removeClass("hidden");else $(".link-used").removeClass("hidden");else $(".link-expired").removeClass("hidden");else $(".link-not-found").removeClass("hidden")}),$(".caution-proceed").on("click",function(){$(".link-first-visit").addClass("hidden"),clearInterval(n),f()}),$(".caution-login-required-auth-link").on("click",function(){$(".caution-proceed").removeClass("hidden")})}();